# ExpressJS Integration #

As [Express](https://expressjs.com) is a very popular web server library for NodeJS, Scout supports easy request tracing with minimal via an `app`-wide middleware.

## Using the Scout integration ##

To use Scout with your ExpressJS application, enable the middleware:

```javascript
const express = require("express");
const app = express();
const scout = require("scout-apm-client").expressMiddleware;

// Enable the app-wide scout middleware
app.use(scout());

// Set up the routes for your application
app.get('/', function (req, res) {
  res.send('hello, world!')
})
```

## Customization ##

The ExpressJS integration offers a few extension points, which are encapsulated by the following interface and described below:

```typescript
interface ExpressMiddlewareOptions {
    config?: ScoutConfiguration;
    requestTimeoutMs?: number;
    logFn?: LogFn;
}
```

| Value              | Type                 | Default  | Description                                                                                                              |
|--------------------|----------------------|----------|--------------------------------------------------------------------------------------------------------------------------|
| `config`           | `ScoutConfiguration` | N/A      | The configuration to be passed when creating the `Scout` instance                                                        |
| `requestTimeoutMs` | `number`             | `300000` | The default timeout for any request trace (any traces on requests that take more than this amount of time are cut short) |
| `logFn`            | `LogFn`              | N/A      | A logging function (that takes `message` and `logLevel` arguments) to allow for logging of the scout layer               |

## How the integration works ##

The Scout middleware tracks every request that goes through your application as they are made. The `app` (`express.Application`) object is augmented with an app-wide `Scout` instance (`app.scout`), which is created automatically during the first request if not provided up front. The `req` (`express.Request`) object is augmented with a `scout` member (`req.scout`) which allows for access to the current request, via `req.scout.request`, and the current root span `req.scout.rootSpan` (in the future other context may be made available on the `req.scout` object).

Traces generated by the ExpressJS integration create Scout requests with at least a single `Controller/<METHOD> <ROUTE>` span, where `METHOD` is the HTTP method (GET, POST, PUT, etc), and `ROUTE` is the route of your request, in generic form (ex. `users/:id`) where possible.

## How to add to your traces and tag your traces ##

To add spans and/or tag your requests/spans, use the `req.scout.rootSpan` object's methods `addSpan` and `tagRequest`.
